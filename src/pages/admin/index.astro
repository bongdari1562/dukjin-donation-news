---
const title = "덕진노인복지관 후원소식 · 관리자";
---

<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>

    <!-- ✅ Netlify Identity 위젯 -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>

  <body style="margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;">
    <!-- ✅ 위젯 열기 버튼(비밀번호 재설정은 여기서 함) -->
    <div style="position:fixed; top:12px; right:12px; z-index:9999;">
      <button
        id="open-identity"
        style="padding:10px 12px; border:1px solid #e4e4e7; background:white; border-radius:10px; cursor:pointer;"
        title="관리자 로그인 / 비밀번호 재설정"
      >
        관리자 로그인
      </button>
    </div>

    <!-- Decap CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <script>
      // 버튼 누르면 Netlify Identity 위젯(로그인 팝업) 열기
      const btn = document.getElementById("open-identity");
      btn?.addEventListener("click", () => {
        if (window.netlifyIdentity) window.netlifyIdentity.open("login");
      });

      // recovery/invite/confirm 토큰이 URL 해시에 붙어 들어오면 위젯이 자동 처리하도록
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", () => {
          const hash = window.location.hash || "";
          if (
            hash.includes("recovery_token=") ||
            hash.includes("invite_token=") ||
            hash.includes("confirmation_token=")
          ) {
            // 위젯을 열어주면 비번설정/확인 흐름이 뜨는 경우가 많음
            window.netlifyIdentity.open();
          }
        });

        // 로그인 성공하면 /admin/으로 고정
        window.netlifyIdentity.on("login", () => {
          window.location.href = "/admin/";
        });
      }
    </script>
  </body>
</html>
